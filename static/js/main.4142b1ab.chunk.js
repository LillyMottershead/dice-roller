(this.webpackJsonpquickroll=this.webpackJsonpquickroll||[]).push([[0],{18:function(t,e,n){},19:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var a=n(2),r=n.n(a),c=n(12),l=n.n(c),s=(n(18),n(3)),i=n(13),o=n(6),u=n(7),d=n(1),h=n(9),m=n(8),p=(n(19),n(11)),f=function(t,e){return t+e},g=/^(\d+)?d(\d+)(?:k([l-])?(\d+))?$/,j=/\s+/,b=/^(?:(?:(?:\d+)?d\d+(?:k(?:[l-])?\d+)?)|[+\-*/()]|\d+|\s+)+$/,x=/((?:\d+)?d\d+(?:k(?:[l-])?\d+)?)|([+\-*/()])|(\d+)/g,v=/\[(.*?)\]/g,O=/\{(.*?)\}/g,y=/(?:(\w+)(?:\((.*?)\))?)/g,C={add:function(t,e){var n,a=e.match(x);"+-*/".includes(a[0])||t.tokens.push("+");(n=t.tokens).push.apply(n,Object(s.a)(a))},replace:w,adv:function(t){return w(t,"d20","2d20k1")},dis:function(t){return w(t,"d20","2d20kl1")},max:function(t){return t.max=!0},tohit:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;t.tohit=!0,t.minToCrit=e},cancrit:function(t){return t.cancrit=!0},crit:function(t){return t.crit=!0}};function k(t){this.name="RollError",this.message=t,this.stack=(new Error).stack}function S(t){return null!==t.match(g)}function N(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.match(g);if(!n)throw new k("Cannot parse ".concat(t," as a valid roll."));var a=+n[2],r=+n[1]||1,c=+n[4]||0,l=!n[3];if(a<2)throw new k("Less than 2 sides in ".concat(t));if(r<1)throw new k("Rolling less than 1 time in ".concat(t));if(c<0)throw new k("Cannot keep less 1 die in ".concat(t));if(c>r)throw new k("Cannot keep more die than are rolled in ".concat(t));for(var s=c?"k".concat(l?"":"l").concat(c):"",i="".concat(r,"d").concat(a).concat(s),o=[],u=0;u<r;u++)o.push({sides:a,num:e?a:Math.ceil(Math.random()*a),kept:!0});if(c<r){var d=[].concat(o);d.sort((function(t,e){return t.num-e.num})),l||d.reverse(),d.slice(0,c).forEach((function(t){return t.kept=!1}))}var h=o.filter((function(t){return t.kept})).map((function(t){return t.num})),m=h.reduce(f);return{sides:a,result:m,rolls:o,desc:"".concat(i," (").concat(o.map((function(t){return t.num})).join(", "),")")}}function w(t,e,n){-1!==t.tokens.indexOf(e)&&(t.tokens[t.tokens.indexOf(e)]=n)}function R(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"addmaxdice",r={crit:n};r.label=Array.from(t.matchAll(v),(function(t){return t[1]}))[0]||"",t=t.replaceAll(v,"");var c=Array.from(t.matchAll(y));if((c=c.filter((function(t){return!t[0].match(b)}))).reverse(),c.forEach((function(e){t="".concat(t.slice(0,e.index)).concat(t.slice(e.index+e[0].length))})),c.reverse(),c=c.map((function(t){var e={name:t[1]};return e.params=t[2]?t[2].split(/\s*,\s*/):[],e})),!t.match(b))throw new k("Unknown command.");r.tokens=t.match(x);var l,i=Object(p.a)(c);try{for(i.s();!(l=i.n()).done;){var o=l.value;C[o.name]&&C[o.name].apply(C,[r].concat(Object(s.a)(o.params)))}}catch(g){i.e(g)}finally{i.f()}var u=r.tokens.map((function(t){return S(t)?N(t,r.max||!1):t}));r.dice=u.filter((function(t){return void 0!==t.desc})),r.dice=(e=[]).concat.apply(e,Object(s.a)(r.dice.map((function(t){return t.rolls})))),r.desc=u.map((function(t){return t.desc||t})).join(" ");var d=u.map((function(t){return t.result||t})).join(" ");if(r.result=Function("return ".concat(d,";"))(),r.tohit&&(r.crit=u.find((function(t){return 20===t.sides})).result>=r.minToCrit||r.crit),r.crit&&r.cancrit){var h=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=r.tokens.filter((function(t){return S(t)}));e=e.map((function(e){return N(e,t)})),r.critDesc=e.map((function(t){return t.desc})).join(" + "),r.critResult=e.map((function(t){return t.result})).reduce(f)};if("rolldouble"===a)h();else if("doubledice"===a){var m=u.filter((function(t){return"object"===typeof t}));r.critDesc=m.map((function(t){return t.desc})).join(" + "),r.critResult=m.map((function(t){return t.result})).reduce(f)}else"addmaxdice"===a&&h(!0);r.fullString="".concat(r.desc," = ").concat(r.result),r.critString="CRIT: ".concat(r.critDesc," = ").concat(r.critResult)}else r.fullString="".concat(r.desc," = ").concat(r.result);return r}function A(t,e){var n=Array.from(e.matchAll(y));n=n.map((function(t){var e={name:t[1]};return e.params=t[2]?t[2].split(/\s*,\s*/):[],e}));var a,r=Object(p.a)(n);try{for(r.s();!(a=r.n()).done;){var c=a.value;if("attack"===c.name){t[0]=t[0].concat(" tohit");var l=c.params;0===l.length&&(l=Object(s.a)(new Array(t.length).keys()).slice(1)),l.forEach((function(e){return t[e]=t[e].concat(" cancrit")}))}else{if(!Object.keys(C).includes(c.name))throw new k("Unrecognized argument ".concat(c.name));var i=C[c.name],o=void 0;c.params.length===i.length-1?o=0:(o=+c.params[c.params.length-1]-1,c.params=c.params.slice(0,c.params.length)),c="".concat(c.name,"(").concat(c.params.join(","),")"),t[o]=t[o].concat(" ",c)}}}catch(u){r.e(u)}finally{r.f()}}function I(t){var e=JSON.parse(localStorage.aliases);if(t.length<1)throw new k("Missing target alias to delete.");var n=t[0];if(!e[n])throw new k("Alias ".concat(n," does not exist."));return delete e[n],localStorage.setItem("aliases",JSON.stringify(e)),{message:"Removed ".concat(n," from list of aliases."),alias:n}}k.prototype=new Error;var J=function(t,e){if(""===t)throw new k("Empty command.");var n=t.split(j),a=n[0];return n=n.slice(1),"alias"===a?function(t){var e=JSON.parse(localStorage.aliases);function n(){var t=JSON.parse(localStorage.aliases);return 0===Object.keys(t).length?{message:"No aliases."}:{message:"Aliases: ".concat(Object.keys(t).join(", "))}}if(t.length<1)return n();var a=t[0];if(t=t.slice(1),"delete"===a)return I(t);if("list"===a)return n();if(t.length<1){if(!e[a])throw new k("Alias ".concat(a," does not exist."));return{message:"".concat(a,": ").concat(e[a].rolls.join(", "))}}var r=t.join(" ");return e[a]={rolls:Array.from(r.matchAll(O),(function(t){return t[1]}))},r=r.replaceAll(O,""),A(e[a].rolls,r),localStorage.setItem("aliases",JSON.stringify(e)),{message:"Added ".concat(a," to aliases."),alias:a}}(n):"delete"===a?I(n):JSON.parse(localStorage.aliases)[a]?function(t,e,n){var a=JSON.parse(localStorage.aliases)[t].rolls;A(a=a.concat(Array.from(e.matchAll(O),(function(t){return t[1]}))),e=e.replaceAll(O,""));var r=!1;return a=a.map((function(t){var e=R(t,r,n=n);return r=e.crit||r,e})),{message:"Calling ".concat(t,":"),rolls:a}}(a,Array.from(n).join(" "),e):{message:"Rolling ".concat(t,":"),rolls:[R(t,e=e)]}},F=n(0),L=function(t){Object(h.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(o.a)(this,n),a=e.call(this,t),localStorage.aliases||localStorage.setItem("aliases",JSON.stringify({})),localStorage.settings||localStorage.setItem("settings",JSON.stringify({critRule:"rolldouble"})),a.state={page:"roller",settings:JSON.parse(localStorage.settings)},a.onPageClick=a.onPageClick.bind(Object(d.a)(a)),a.onSettingsChange=a.onSettingsChange.bind(Object(d.a)(a)),a}return Object(u.a)(n,[{key:"onPageClick",value:function(t){this.setState({page:t.target.name})}},{key:"onSettingsChange",value:function(t){var e=this.state.settings;e[t.target.name]=t.target.value,this.setState({settings:e}),localStorage.setItem("settings",JSON.stringify(e))}},{key:"render",value:function(){return Object(F.jsxs)("div",{children:[Object(F.jsx)("h1",{style:{padding:"10px"},children:" quickroll "}),Object(F.jsxs)("span",{style:{padding:"10px"},children:[Object(F.jsx)("button",{className:"panel input",name:"roller",onClick:this.onPageClick,children:"Roller"}),Object(F.jsx)("button",{className:"panel input",name:"settings",onClick:this.onPageClick,children:"Settings"})]}),Object(F.jsx)(K,{show:"roller"===this.state.page,settings:this.state.settings}),Object(F.jsx)(E,{show:"settings"===this.state.page,settings:this.state.settings,onSettingsChange:this.onSettingsChange})]})}}]),n}(r.a.Component),K=function(t){Object(h.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).state={rollCommand:"",times:"",output:{calls:[],currKey:0},aliases:JSON.parse(localStorage.aliases||"{ }"),log:{components:[],currKey:0}},a.textInputRef=r.a.createRef(),a.onRollFormChange=a.onRollFormChange.bind(Object(d.a)(a)),a.onLogClear=a.onLogClear.bind(Object(d.a)(a)),a.hideCall=a.hideCall.bind(Object(d.a)(a)),a.handleCommand=a.handleCommand.bind(Object(d.a)(a)),a.onSubmit=a.onSubmit.bind(Object(d.a)(a)),a}return Object(u.a)(n,[{key:"onRollFormChange",value:function(t){var e=t.target,n=e.value,a=e.name;this.setState(Object(i.a)({},a,n))}},{key:"onLogClear",value:function(t){t.preventDefault(),this.setState({log:{components:[],currKey:0}})}},{key:"hideCall",value:function(t){this.setState((function(e){return e.output.calls[t]=null,{output:e.output}})),1===this.state.output.calls.filter((function(t){return null!==t})).length&&this.setState({output:{calls:[],currKey:0}}),this.textInputRef.current.focus()}},{key:"handleCommand",value:function(t,e){var n=this;var a=Object(s.a)(new Array(e).keys()).map((function(e,a){return function(t,e,n,a,r){function c(t,e){t.components.length>100&&t.components.pop(),t.components.unshift(Object(F.jsxs)("p",{children:[" ",e," "]},"log#".concat(t.currKey++))),t.currKey%=101}var l;try{l=J(t,a),c(n,l.message),l.rolls?(l.rolls.forEach((function(t){var e;e=t.critString?"".concat(t.fullString,", ").concat(t.critString,", ").concat(t.result," ").concat(t.label):"".concat(t.fullString," ").concat(t.label),c(n,e)})),l=l.rolls.map((function(t,e){return Object(F.jsx)(q,{roll:t},"roll#".concat(e))}))):l=Object(F.jsxs)("div",{className:"panel flex-child",children:[" ",l.message," "]})}catch(s){c(n,s.message),l=Object(F.jsxs)("div",{className:"panel flex-child",children:[" ",s.message," "]})}return Object(F.jsx)(T,{rolls:l,handleClose:function(){return r(e)}},"call#".concat(e))}(t,n.state.output.currKey+a,n.state.log,n.props.settings.critRule,n.hideCall)}));this.setState((function(t){return{output:{calls:[].concat(Object(s.a)(t.output.calls),Object(s.a)(a)),currKey:t.output.currKey+a.length},aliases:JSON.parse(localStorage.aliases||"{ }"),log:t.log}})),this.textInputRef.current.focus()}},{key:"onSubmit",value:function(t){t.preventDefault(),"clear"===this.state.rollCommand?this.setState({output:{calls:[],currKey:0}}):"clear log"===this.state.rollCommand?this.onLogClear(t):""!==this.state.rollCommand&&this.handleCommand(this.state.rollCommand,+this.state.times||1),""!==this.state.rollCommand&&this.setState({rollCommand:"",times:""}),this.textInputRef.current.focus()}},{key:"render",value:function(){return this.props.show?Object(F.jsxs)("div",{className:"h-container",children:[Object(F.jsxs)("div",{className:"v-container flex-fill",style:{minWidth:"600px"},children:[Object(F.jsx)(D,{rollCommand:this.state.rollCommand,times:this.state.times,onRollFormChange:this.onRollFormChange,onSubmit:this.onSubmit,textInputRef:this.textInputRef}),Object(F.jsx)("div",{className:"flex-fill",style:{margin:"1em"},children:Object(F.jsx)("div",{className:"h-container",style:{alignItems:"center",height:"450px",overflow:"auto"},children:this.state.output.calls.filter((function(t){return null!==t})).reverse()})}),Object(F.jsx)("div",{className:"h-container",children:Object(F.jsx)(W,{log:this.state.log.components,onLogClear:this.onLogClear})})]}),Object(F.jsx)(U,{aliases:this.state.aliases,handleUpload:this.handleUpload,handleCommand:this.handleCommand})]}):null}}]),n}(r.a.Component),E=function(t){Object(h.a)(n,t);var e=Object(m.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){if(!this.props.show)return null;function t(t,e,n){return Object(F.jsx)(P,{name:"critRule",value:t,onChange:n.onSettingsChange,content:e,checked:n.settings.critRule===t})}return Object(F.jsx)("div",{children:Object(F.jsxs)("div",{className:"panel",style:{textAlign:"left"},children:[Object(F.jsx)("h2",{style:{textAlign:"center"},children:" Settings "}),Object(F.jsx)("h3",{children:" Crit Rule "}),Object(F.jsx)("i",{style:{fontSize:".75em"},children:"Note that this only applies to future rolls."}),Object(F.jsxs)("form",{style:{paddingTop:".75em"},children:[t("rolldouble","Roll double the number of dice.",this.props),Object(F.jsx)("br",{}),t("doubledice","Roll the dice normally and double them.",this.props),Object(F.jsx)("br",{}),t("addmaxdice","Roll the dice normally and add the maximum possible dice roll on top.",this.props),Object(F.jsx)("br",{})]})]})})}}]),n}(r.a.Component);function P(t){return Object(F.jsxs)("label",{className:"input-radio-container",children:[Object(F.jsx)("input",{type:"radio",name:t.name,value:t.value,onChange:t.onChange,checked:t.checked}),Object(F.jsx)("span",{className:"input-radio-check"}),t.content]})}function D(t){return Object(F.jsxs)("form",{style:{margin:"10px"},children:[Object(F.jsx)("input",{className:"panel input-text",type:"text",ref:t.textInputRef,autoFocus:!0,name:"rollCommand",value:t.rollCommand,onChange:t.onRollFormChange}),Object(F.jsx)("input",{className:"panel input-text",type:"text",style:{width:"30px"},name:"times",value:t.times,onChange:t.onRollFormChange}),Object(F.jsx)("input",{className:"panel input",type:"submit",value:">",onClick:t.onSubmit})]})}function T(t){return Object(F.jsxs)("div",{className:"h-container call",onClick:t.handleClose,style:{position:"relative",padding:"1em"},children:[t.rolls,Object(F.jsx)("span",{className:"close-button",children:Object(F.jsx)(B,{color:"red"})})]})}function q(t){var e=t.roll.result+(t.roll.critResult||0),n=t.roll.label||"",a=t.roll.fullString||"",r=t.roll.critString||"",c=t.roll.dice.map((function(t,e){return Object(F.jsx)(M,{die:t},"rollImage#".concat(e,"}"))}));return Object(F.jsxs)("div",{className:"panel flex-child tooltip",style:{background:"",margin:"-1px",marginBottom:"0px"},children:[c,Object(F.jsxs)("p",{children:[e," ",Object(F.jsxs)("span",{style:{fontSize:".75em"},children:[" ",n," "]})]}),Object(F.jsxs)("span",{className:"tooltiptext",children:[a," ",Object(F.jsx)("br",{})," ",r]})]})}function M(t){var e="/quick-dice",n=t.die.kept?"dice/":"gray_dice/",a=t.die.sides,r=t.die.num;return e="".concat(e,"/").concat(n,"d").concat(a,"_").concat(r,".svg"),Object(F.jsx)("img",{src:e,alt:"".concat(r," (d").concat(a,")"),height:"50px"})}function U(t){var e=Object.keys(t.aliases);return e.sort(),e=e.map((function(e,n){return Object(F.jsx)(z,{aliasName:e,handleCommand:t.handleCommand},"alias#".concat(n))})),Object(F.jsxs)("div",{className:"panel flex-child aliases",children:[Object(F.jsx)("label",{className:"h2",children:" Aliases "}),Object(F.jsx)("div",{children:e})]})}function z(t){return Object(F.jsxs)("div",{style:{margin:"5px",padding:"5px",border:"1px #6b6c75 solid",textAlign:"left",position:"relative"},children:[Object(F.jsx)("div",{style:{width:"90%",cursor:"pointer"},onClick:function(){return t.handleCommand(t.aliasName,1)},children:t.aliasName}),Object(F.jsx)("span",{style:{position:"absolute",right:"5px",top:"5px",cursor:"pointer"},onClick:function(){return t.handleCommand("alias delete ".concat(t.aliasName),1)},children:Object(F.jsx)(B,{})})]})}function B(t){var e=t.color||"#95969e";return Object(F.jsxs)("svg",{width:"10",height:"10",children:[Object(F.jsx)("line",{x1:"0",y1:"0",x2:"10",y2:"10",style:{stroke:e,strokeWidth:2}}),Object(F.jsx)("line",{x1:"0",y1:"10",x2:"10",y2:"0",style:{stroke:e,strokeWidth:2}})]})}function W(t){return Object(F.jsxs)("div",{className:"panel log",children:[Object(F.jsxs)("h2",{children:["Log",Object(F.jsx)("button",{className:"panel input",onClick:t.onLogClear,children:"Clear"})]}),Object(F.jsx)("div",{className:"inner-log",children:t.log})]})}var $=L,_=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,l=e.getTTFB;n(t),a(t),r(t),c(t),l(t)}))};l.a.render(Object(F.jsx)(r.a.StrictMode,{children:Object(F.jsx)($,{})}),document.getElementById("root")),_()}},[[21,1,2]]]);
//# sourceMappingURL=main.4142b1ab.chunk.js.map