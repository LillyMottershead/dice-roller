(this.webpackJsonpquickroll=this.webpackJsonpquickroll||[]).push([[0],{18:function(t,e,n){},19:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var a=n(1),c=n.n(a),r=n(12),s=n.n(r),o=(n(18),n(2)),l=n(13),i=n(6),u=n(7),m=n(3),d=n(9),h=n(8),f=(n(19),n(11)),p=function(t,e){return t+e},g=/^(\d+)?d(\d+)(?:k([l-])?(\d+))?$/,j=/\s+/,b=/^(?:(?:(?:\d+)?d\d+(?:k(?:[l-])?\d+)?)|[+\-*/()]|\d+|\s+)+$/,O=/((?:\d+)?d\d+(?:k(?:[l-])?\d+)?)|([+\-*/()])|(\d+)/g,x=/\[(.*?)\]/g,v=/\{(.*?)\}/g,y=/(?:(\w+)(?:\((.*?)\))?)/g,S={add:function(t,e){var n,a=e.match(O);"+-*/".includes(a[0])||t.tokens.push("+");(n=t.tokens).push.apply(n,Object(o.a)(a))},replace:N,adv:function(t){return N(t,"d20","2d20k1")},dis:function(t){return N(t,"d20","2d20kl1")},max:function(t){return t.max=!0},tohit:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;t.tohit=!0,t.minToCrit=e},cancrit:function(t){return t.cancrit=!0},crit:function(t){return t.crit=!0}};function C(t){this.name="RollError",this.message=t,this.stack=(new Error).stack}function k(t){return null!==t.match(g)}function w(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.match(g);if(!n)throw new C("Cannot parse ".concat(t," as a valid roll."));var a=+n[2],c=+n[1]||1,r=+n[4]||0,s=!n[3];if(a<2)throw new C("Less than 2 sides in ".concat(t));if(c<1)throw new C("Rolling less than 1 time in ".concat(t));if(r<0)throw new C("Cannot keep less 1 die in ".concat(t));if(r>c)throw new C("Cannot keep more die than are rolled in ".concat(t));for(var o=r?"k".concat(s?"":"l").concat(r):"",l="".concat(c,"d").concat(a).concat(o),i=[],u=0;u<c;u++)i.push({sides:a,num:e?a:Math.ceil(Math.random()*a),kept:!0});if(r<c){var m=[].concat(i);m.sort((function(t,e){return t.num-e.num})),s||m.reverse(),m.slice(0,r).forEach((function(t){return t.kept=!1}))}var d=i.filter((function(t){return t.kept})).map((function(t){return t.num})),h=d.reduce(p);return{sides:a,result:h,rolls:i,desc:"".concat(l," (").concat(i.map((function(t){return t.num})).join(", "),")")}}function N(t,e,n){-1!==t.tokens.indexOf(e)&&(t.tokens[t.tokens.indexOf(e)]=n)}function R(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"addmaxdice",c={crit:n};c.label=Array.from(t.matchAll(x),(function(t){return t[1]}))[0]||"",t=t.replaceAll(x,"");var r=Array.from(t.matchAll(y));if((r=r.filter((function(t){return!t[0].match(b)}))).reverse(),r.forEach((function(e){t="".concat(t.slice(0,e.index)).concat(t.slice(e.index+e[0].length))})),r.reverse(),r=r.map((function(t){var e={name:t[1]};return e.params=t[2]?t[2].split(/\s*,\s*/):[],e})),!t.match(b))throw new C("Unknown command.");c.tokens=t.match(O);var s,l=Object(f.a)(r);try{for(l.s();!(s=l.n()).done;){var i=s.value;S[i.name]&&S[i.name].apply(S,[c].concat(Object(o.a)(i.params)))}}catch(g){l.e(g)}finally{l.f()}var u=c.tokens.map((function(t){return k(t)?w(t,c.max||!1):t}));c.dice=u.filter((function(t){return void 0!==t.desc})),c.dice=(e=[]).concat.apply(e,Object(o.a)(c.dice.map((function(t){return t.rolls})))),c.desc=u.map((function(t){return t.desc||t})).join(" ");var m=u.map((function(t){return t.result||t})).join(" ");if(c.result=Function("return ".concat(m,";"))(),c.tohit&&(c.crit=u.find((function(t){return 20===t.sides})).result>=c.minToCrit||c.crit),c.crit&&c.cancrit){var d=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=c.tokens.filter((function(t){return k(t)}));e=e.map((function(e){return w(e,t)})),c.critDesc=e.map((function(t){return t.desc})).join(" + "),c.critResult=e.map((function(t){return t.result})).reduce(p)};if("rolldouble"===a)d();else if("doubledice"===a){var h=u.filter((function(t){return"object"===typeof t}));c.critDesc=h.map((function(t){return t.desc})).join(" + "),c.critResult=h.map((function(t){return t.result})).reduce(p)}else"addmaxdice"===a&&d(!0);c.fullString="".concat(c.desc," = ").concat(c.result),c.critString="CRIT: ".concat(c.critDesc," = ").concat(c.critResult)}else c.fullString="".concat(c.desc," = ").concat(c.result);return c}function A(t,e){var n=Array.from(e.matchAll(y));n=n.map((function(t){var e={name:t[1]};return e.params=t[2]?t[2].split(/\s*,\s*/):[],e}));var a,c=Object(f.a)(n);try{for(c.s();!(a=c.n()).done;){var r=a.value;if("attack"===r.name){t[0]=t[0].concat(" tohit");var s=r.params;0===s.length&&(s=Object(o.a)(new Array(t.length).keys()).slice(1)),s.forEach((function(e){return t[e]=t[e].concat(" cancrit")}))}else{if(!Object.keys(S).includes(r.name))throw new C("Unrecognized argument ".concat(r.name));var l=S[r.name],i=void 0;r.params.length===l.length-1?i=0:(i=+r.params[r.params.length-1]-1,r.params=r.params.slice(0,r.params.length)),r="".concat(r.name,"(").concat(r.params.join(","),")"),t[i]=t[i].concat(" ",r)}}}catch(u){c.e(u)}finally{c.f()}}function J(t){var e=JSON.parse(localStorage.aliases);if(t.length<1)throw new C("Missing target alias to delete.");var n=t[0];if(!e[n])throw new C("Alias ".concat(n," does not exist."));return delete e[n],localStorage.setItem("aliases",JSON.stringify(e)),{message:"Removed ".concat(n," from list of aliases."),alias:n}}C.prototype=new Error;var I=function(t,e){if(""===t)throw new C("Empty command.");var n=t.split(j),a=n[0];return n=n.slice(1),"alias"===a?function(t){var e=JSON.parse(localStorage.aliases);function n(){var t=JSON.parse(localStorage.aliases);return 0===Object.keys(t).length?{message:"No aliases."}:{message:"Aliases: ".concat(Object.keys(t).join(", "))}}if(t.length<1)return n();var a=t[0];if(t=t.slice(1),"delete"===a)return J(t);if("list"===a)return n();if(t.length<1){if(!e[a])throw new C("Alias ".concat(a," does not exist."));return{message:"".concat(a,": ").concat(e[a].rolls.join(", "))}}var c=t.join(" ");return e[a]={rolls:Array.from(c.matchAll(v),(function(t){return t[1]}))},c=c.replaceAll(v,""),A(e[a].rolls,c),localStorage.setItem("aliases",JSON.stringify(e)),{message:"Added ".concat(a," to aliases."),alias:a}}(n):"delete"===a?J(n):JSON.parse(localStorage.aliases)[a]?function(t,e,n){var a=JSON.parse(localStorage.aliases)[t].rolls;A(a=a.concat(Array.from(e.matchAll(v),(function(t){return t[1]}))),e=e.replaceAll(v,""));var c=!1;return a=a.map((function(t){var e=R(t,c,n=n);return c=e.crit||c,e})),{message:"Calling ".concat(t,":"),rolls:a}}(a,Array.from(n).join(" "),e):{message:"Rolling ".concat(t,":"),rolls:[R(t,e=e)]}},F=n(0),L=function(t){Object(d.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(i.a)(this,n),a=e.call(this,t),localStorage.aliases||localStorage.setItem("aliases",JSON.stringify({})),localStorage.settings||localStorage.setItem("settings",JSON.stringify({critRule:"rolldouble"})),a.state={page:"settings",settings:JSON.parse(localStorage.settings)},a.onPageClick=a.onPageClick.bind(Object(m.a)(a)),a.onSettingsChange=a.onSettingsChange.bind(Object(m.a)(a)),a}return Object(u.a)(n,[{key:"onPageClick",value:function(t){this.setState({page:t.target.name})}},{key:"onSettingsChange",value:function(t){var e=this.state.settings;e[t.target.name]=t.target.value,this.setState({settings:e}),localStorage.setItem("settings",JSON.stringify(e))}},{key:"render",value:function(){return Object(F.jsxs)("section",{children:[Object(F.jsx)("h1",{children:" quickroll "}),Object(F.jsxs)("span",{children:[Object(F.jsx)("button",{className:"panel input",name:"roller",onClick:this.onPageClick,children:"Roller"}),Object(F.jsx)("button",{className:"panel input",name:"settings",onClick:this.onPageClick,children:"Settings"})]}),Object(F.jsx)(E,{show:"roller"===this.state.page,settings:this.state.settings}),Object(F.jsx)(K,{show:"settings"===this.state.page,settings:this.state.settings,onSettingsChange:this.onSettingsChange})]})}}]),n}(c.a.Component),E=function(t){Object(d.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(i.a)(this,n),(a=e.call(this,t)).onRollFormChange=function(t){var e=t.target,n=e.value,c=e.name;a.setState(Object(l.a)({},c,n))},a.onLogClear=function(t){t.preventDefault(),a.setState({log:{components:[],currKey:0}})},a.onSubmit=function(t){if(t.preventDefault(),"clear"===a.state.rollCommand)a.setState({rollCommand:"",times:"",output:{calls:[],currKey:0}});else if("clear log"===a.state.rollCommand)a.onLogClear(t),a.setState({rollCommand:"",times:""});else if(""!==a.state.rollCommand){var e=+a.state.times||1,n=Object(o.a)(new Array(e).keys()).map((function(t,e){return function(t,e,n,a){function c(t,e){t.components.length>100&&t.components.pop(),t.components.unshift(Object(F.jsxs)("p",{children:[" ",e," "]},"log#".concat(t.currKey++))),t.currKey%=101}var r;try{r=I(t,a),c(n,r.message),r.rolls?(r.rolls.forEach((function(t){var e;e=t.critString?"".concat(t.fullString,", ").concat(t.critString,", ").concat(t.result," ").concat(t.label):"".concat(t.fullString," ").concat(t.label),c(n,e)})),r=r.rolls.map((function(t,e){return Object(F.jsx)(q,{roll:t},"roll#".concat(e))}))):r=Object(F.jsxs)("div",{className:"panel flex-child",children:[" ",r.message," "]})}catch(s){c(n,s.message),r=Object(F.jsxs)("div",{className:"panel flex-child",children:[" ",s.message," "]})}return Object(F.jsx)(T,{rolls:r},"call#".concat(e))}(a.state.rollCommand,a.state.output.currKey+e,a.state.log,a.props.settings.critRule)}));a.setState({rollCommand:"",times:"",output:{calls:[].concat(Object(o.a)(a.state.output.calls),Object(o.a)(n)),currKey:a.state.output.currKey+n.length},aliases:JSON.parse(localStorage.aliases||"{ }"),log:a.state.log})}a.textInputRef.current.focus()},a.state={rollCommand:"",times:"",output:{calls:[],currKey:0},aliases:JSON.parse(localStorage.aliases||"{ }"),log:{components:[],currKey:0}},a.textInputRef=c.a.createRef(),a.onSubmit=a.onSubmit.bind(Object(m.a)(a)),a.onRollFormChange=a.onRollFormChange.bind(Object(m.a)(a)),a.onLogClear=a.onLogClear.bind(Object(m.a)(a)),a}return Object(u.a)(n,[{key:"render",value:function(){return this.props.show?Object(F.jsxs)("section",{children:[Object(F.jsx)(D,{rollCommand:this.state.rollCommand,times:this.state.times,onRollFormChange:this.onRollFormChange,onSubmit:this.onSubmit,textInputRef:this.textInputRef}),Object(F.jsxs)("section",{className:"h-container",children:[" ",this.state.output.calls," "]}),Object(F.jsxs)("section",{className:"h-container",children:[Object(F.jsx)(U,{aliases:this.state.aliases,handleUpload:this.handleUpload}),Object(F.jsx)(z,{log:this.state.log.components,onLogClear:this.onLogClear})]})]}):null}}]),n}(c.a.Component),K=function(t){Object(d.a)(n,t);var e=Object(h.a)(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){if(!this.props.show)return null;function t(t,e,n){return Object(F.jsx)(P,{name:"critRule",value:t,onChange:n.onSettingsChange,content:e,checked:n.settings.critRule===t})}return Object(F.jsx)("section",{children:Object(F.jsxs)("div",{className:"panel",style:{textAlign:"left"},children:[Object(F.jsx)("h2",{style:{textAlign:"center"},children:" Settings "}),Object(F.jsx)("h3",{children:" Crit Rule "}),Object(F.jsx)("i",{style:{fontSize:".75em"},children:"Note that this only applies to future rolls."}),Object(F.jsxs)("form",{style:{paddingTop:".75em"},children:[t("rolldouble","Roll double the number of dice.",this.props),Object(F.jsx)("br",{}),t("doubledice","Roll the dice normally and double them.",this.props),Object(F.jsx)("br",{}),t("addmaxdice","Roll the dice normally and add the maximum possible dice roll on top.",this.props),Object(F.jsx)("br",{})]})]})})}}]),n}(c.a.Component);function P(t){return Object(F.jsxs)("label",{className:"input-radio-container",children:[Object(F.jsx)("input",{type:"radio",name:t.name,value:t.value,onChange:t.onChange,checked:t.checked}),Object(F.jsx)("span",{className:"input-radio-check"}),t.content]})}function D(t){return Object(F.jsxs)("form",{style:{margin:"10px"},children:[Object(F.jsx)("input",{className:"panel input-text",type:"text",ref:t.textInputRef,autoFocus:!0,name:"rollCommand",value:t.rollCommand,onChange:t.onRollFormChange}),Object(F.jsx)("input",{className:"panel input-text",type:"text",style:{width:"30px"},name:"times",value:t.times,onChange:t.onRollFormChange}),Object(F.jsx)("input",{className:"panel input",type:"submit",value:">",onClick:t.onSubmit})]})}function T(t){return Object(F.jsx)("section",{className:"h-container flex-child",style:{border:"none",margin:"10px",maxWidth:"30%"},children:t.rolls})}function q(t){var e=t.roll.result+(t.roll.critResult||0),n=t.roll.label||"",a=t.roll.fullString||"",c=t.roll.critString||"",r=t.roll.dice.map((function(t,e){return Object(F.jsx)(M,{die:t},"rollImage#".concat(e,"}"))}));return Object(F.jsxs)("div",{className:"panel flex-child tooltip",style:{margin:"-1px",marginBottom:"0px"},children:[r,Object(F.jsxs)("p",{children:[e," ",Object(F.jsxs)("span",{style:{fontSize:".75em"},children:[" ",n," "]})]}),Object(F.jsxs)("span",{className:"tooltiptext",children:[a," ",Object(F.jsx)("br",{})," ",c]})]})}function M(t){var e="/quick-dice",n=t.die.kept?"dice/":"gray_dice/",a=t.die.sides,c=t.die.num;return e="".concat(e,"/").concat(n,"d").concat(a,"_").concat(c,".svg"),Object(F.jsx)("img",{src:e,alt:"".concat(c," (d").concat(a,")"),height:"50px"})}function U(t){var e=Object.keys(t.aliases);return e.sort(),e=e.map((function(t,e){return Object(F.jsxs)("p",{children:[" ",t," "]},"alias#".concat(e))})),Object(F.jsxs)("div",{className:"panel flex-child aliases",children:[Object(F.jsx)("form",{style:{padding:"5px"},children:Object(F.jsx)("label",{className:"h2",children:" Aliases "})}),Object(F.jsxs)("div",{children:[" ",e," "]})]})}function z(t){return Object(F.jsxs)("div",{className:"panel log",children:[Object(F.jsxs)("h2",{children:["Log",Object(F.jsx)("button",{className:"panel input",onClick:t.onLogClear,children:"Clear"})]}),Object(F.jsx)("div",{className:"inner-log",children:t.log})]})}var B=L,$=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(e){var n=e.getCLS,a=e.getFID,c=e.getFCP,r=e.getLCP,s=e.getTTFB;n(t),a(t),c(t),r(t),s(t)}))};s.a.render(Object(F.jsx)(c.a.StrictMode,{children:Object(F.jsx)(B,{})}),document.getElementById("root")),$()}},[[21,1,2]]]);
//# sourceMappingURL=main.d7fa0300.chunk.js.map